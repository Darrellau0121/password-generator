# 密码生成器 PRD

## 1. 概述

- 目标：提供安全、可控、可复用的密码/口令/通行密钥生成工具，覆盖个人与团队场景。
- 受众：开发者、安全从业者、高阶用户、全球用户（支持 7 种语言）。
- 成功度量：生成质量（熵/复杂性）、可用性（操作步数/成功率）、错误率、性能、可扩展性、国际化覆盖度。

## 2. 范围与非目标

- 范围：本地生成、不持久化；可配置策略；导出/复制；批量生成；熵与强度可视化；多语言支持。
- 非目标：密码保管库、云同步、账户集成、自动填充。

## 3. 用户故事

- 开发者：批量生成 API 密钥片段，长度与字符集可控。
- 安全人员：可审计的随机源与熵报告。
- 普通用户：一键获得强密码并可读可复制。
- 国际用户：使用母语界面操作，无障碍访问。

## 4. 关键功能需求

### 4.1 生成类型

- 随机密码：字符集含大写、小写、数字、符号；可排除相似字符（0/O、1/l/I 等）。
- 词语口令：基于词表的 passphrase；支持分隔符与词数调节。
- 可发音密码：基于音节模板；可混入数字/符号。

### 4.2 策略配置

- 长度范围：8–128；默认 16。
- 字符集：大写[A–Z]、小写[a–z]、数字[0–9]、符号集合（可配置）；默认 大小写+数字。
- 规则开关：
  - 必须包含：大写/小写/数字/符号（默认关闭）。
  - 排除字符集：自定义黑名单（含看似相似字符）。
  - 重复限制：不允许超过 N 次连续相同字符（默认允许，N=3）。
  - 历史避免：仅本会话内不与最近 K 个结果相同（默认 K=0 关闭）。

### 4.3 批量与导出

- 批量生成：1–10,000 条；每条长度 ≤64。
- 导出：TXT/CSV；UTF-8；Web 触发下载，CLI 写文件。

### 4.4 强度与熵

- 展示估算熵（bits）与强度等级（0–4，zxcvbn 风格）。
- 实时随配置变化更新。

### 4.5 交互

- 一键生成按钮；复制按钮（成功提示）；明/暗掩码切换（默认掩码）。
- 验证与错误提示：长度越界、字符集为空、模板非法、批量过大。

### 4.6 国际化

- 支持 7 种语言：英文、中文、德语、俄语、葡萄牙语、西班牙语、越南语。
- 语言切换器：右上角下拉菜单，实时切换界面语言。
- 无障碍支持：所有 `aria-label` 属性支持多语言。
- 语言偏好：本地存储用户选择，下次访问自动恢复。

## 5. 安全与隐私

- 随机源：
  - Web：`window.crypto.getRandomValues`（CSPRNG）。
  - Node：`crypto.randomBytes`（CSPRNG）。
- 禁止使用 `Math.random`；不允许可配置种子。
- 拒绝采样：随机字节到字符集的映射避免模偏。
- 本地计算：不上传、不埋点（可选匿名遥测，默认关闭）。
- 剪贴板：可选复制后 N 秒清空（平台允许时）。

## 6. 性能与兼容性

- 性能目标：10k 条、每条 64 字符在 1 秒内（现代桌面/浏览器）；熵计算 O(n)。
- 兼容：Web（现代浏览器），静态部署，无需服务器。
- 响应式设计：移动端友好，语言切换器自适应布局。

## 7. 信息架构（Web）

- 预览区：生成结果、强度条、熵数值。
- 策略区：长度、字符集、规则开关、模板/词表选项。
- 操作区：生成、复制、批量、导出。

## 8. 算法说明

### 8.1 拒绝采样映射

- 给定字符集大小 `m`，从 CSPRNG 取字节 `b`，仅当 `b < floor(256 / m) * m` 时取 `b % m`，否则丢弃重采，避免模偏。

### 8.2 熵估算

- 字符集密码：`entropy_bits ≈ length * log2(|charset|)`；若强制包含若干类，估计下界可按组合约束修正。
- 词语口令：`entropy_bits ≈ words * log2(|wordlist|)`。
- 可发音密码：按音节状态机近似估计（保守下界）。

## 9. 默认值与上限

- 默认长度 16；字符集：大小写+数字；排除相似字符：关；必须包含：关。
- 词语口令：4 词，分隔符 “-”，词表：EFF-Short（许可合规时）；可选中文词表。
- 批量上限：10,000；导出编码：UTF-8。

## 10. 校验规则

- 长度必须在 8–128；至少一种字符集被选中；模板占位符合法并能产生可行空间；批量与长度乘积不超过内存与时间阈值。

## 11. 测试计划

### 11.1 单元测试

- 字符映射均匀性：频次/卡方烟雾测试。
- 熵计算正确性与边界：已知案例与近似公式验证。
- 策略约束：强制包含、排除字符、重复限制、模板校验。

### 11.2 端到端

- 默认一键生成成功；批量导出成功；无障碍键盘操作路径可行。

### 11.3 基准

- 不同长度/批量吞吐时间统计，满足目标阈值。

## 12. 指标

- 生成耗时 P95、复制成功率、错误率、撤销率。

## 13. 发布计划

- ✅ MVP：随机密码 + 词语口令 + 批量 + 强度/熵 + 多语言支持。
- 迭代：可发音密码、模板化、词表扩展、插件化、更多语言支持。

## 14. 风险与对策

- zxcvbn 体积：按需/Worker 加载；或延迟到交互后。
- 词表版权：采用许可友好资源或自制词表。
- 剪贴板限制：提供降级与手动复制指引。

## 15. 技术实现

- 前端：纯静态 HTML/CSS/JavaScript，无依赖框架。
- 国际化：自定义 i18n 系统，支持动态语言切换。
- 安全：使用 Web Crypto API，拒绝采样避免模偏。
- 部署：静态文件，支持 CDN 和 GitHub Pages。

## 16. 术语

- CSPRNG：加密安全随机数生成器；拒绝采样；模偏。
- i18n：国际化（Internationalization）。

---

文件：`/Users/fuben/Code /password-generator/docs/PRD.md`
